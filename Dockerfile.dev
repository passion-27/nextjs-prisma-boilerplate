
# pick image with git and bash
# ARG BASE=mcr.microsoft.com/vscode/devcontainers/javascript-node:0-16-bullseye
ARG BASE=node:16-bullseye

# --------------------

FROM ${BASE} AS dependencies
WORKDIR /app

COPY package.json yarn.lock ./
RUN yarn install

# ---------------------

FROM ${BASE} AS development
WORKDIR /app
ENV NODE_ENV development

# copy source and node_modules separately
# source from host
COPY . .
# node_modules is .dockerignored on host
# node_modules from dependencies stage
COPY --from=dependencies --chown=node:node /app/node_modules ./node_modules

RUN chown -R node:node /app
USER node

RUN npx prisma generate

EXPOSE 3001
ENV PORT 3001

CMD [ "yarn", "start-dev" ]

